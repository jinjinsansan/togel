# モバイルLoad Failed問題 - デバッグガイド

## 現状
- ✅ デスクトップ: 正常動作
- ⚠️ iPhone実機: 不安定（成功/失敗が交互）

## 確認手順

### 1. Vercelログを確認
https://vercel.com/dashboard → プロジェクト → Logs

以下のエラーを探してください：

#### パターンA: OpenAI "run already active" エラー
```
OpenAI message creation error: Can't add messages to thread_xxx while a run run_xxx is active
```
→ **原因**: ボタン連打、前の処理が完了していない

#### パターンB: OpenAI stream error
```
Michelle AI stream error - Full details: {...}
```
→ **原因**: OpenAI APIのエラー、レート制限など

#### パターンC: タイムアウト
```
Function execution timeout
```
→ **原因**: 処理時間が90秒を超えた

### 2. iPhone実機でのテスト手順

**テスト1: 単発メッセージ**
1. 心理学チャットを開く
2. 短いメッセージを送信（例：「こんにちは」）
3. 応答を待つ
4. ✅ 成功するか？

**テスト2: プリセットボタン（1回）**
1. 「次へ進む」ボタンを押す
2. 応答を待つ（完全に完了するまで待つ）
3. ✅ 成功するか？

**テスト3: プリセットボタン（連打）**
1. 「次へ進む」ボタンを押す
2. **すぐに**もう一度「次へ進む」を押す
3. ⚠️ これで失敗するか？

### 3. 結果の判定

#### ケースA: テスト1は成功、テスト3で失敗
→ **原因**: ボタン連打防止が不十分
→ **解決策**: ボタン無効化を強化

#### ケースB: テスト1でも失敗（ランダム）
→ **原因**: OpenAI APIの不安定性、ネットワーク
→ **解決策**: リトライ機構を追加

#### ケースC: テスト2だけ失敗
→ **原因**: 長い応答でタイムアウト
→ **解決策**: タイムアウト時間を延長

---

## 次のアクション

**Vercelログを確認して、以下を教えてください：**

1. エラーメッセージは何か？
2. どのパターンに該当するか？
3. テスト1-3の結果はどうか？

それに応じて適切な修正を行います。

**git resetは不要です！**
