# ミシェル引き寄せ講座 進捗コード生成ロジック

## 概要

GPTsは会話をまたいで記憶を保持できないため、ユーザーの進捗を「進捗コード」として発行し、次回会話時に申告してもらうことで継続性を実現します。

---

## コード体系

### 基本フォーマット

```
MCL-L{レベル}-S{セクション}-{ステータス}
```

| 要素 | 説明 | 例 |
|------|------|-----|
| MCL | Michelle Course（固定プレフィックス） | MCL |
| L{n} | レベル番号（1-5） | L1, L2, L3, L4, L5 |
| S{nn} | セクション番号（01-20） | S01, S15, S20 |
| ステータス | 完了状態 | OK, IP, RV |

### ステータスコード

| コード | 意味 | 説明 |
|--------|------|------|
| OK | 完了（Okay） | セクションの理解度チェックに合格 |
| IP | 進行中（In Progress） | セクション学習中、チェック未実施 |
| RV | 要復習（Review） | 理解度チェック不合格、復習必要 |

### 例

| コード | 意味 |
|--------|------|
| `MCL-L1-S03-OK` | レベル1・セクション3完了 |
| `MCL-L2-S07-IP` | レベル2・セクション7学習中 |
| `MCL-L3-S13-RV` | レベル3・セクション13要復習 |
| `MCL-L5-S20-OK` | 全講座修了 |

---

## 特殊コード

### 初回診断コード

診断結果に基づいて発行される初期コード

| コード | 意味 |
|--------|------|
| `MCL-NEW-BEGINNER` | 完全初心者、S1から開始 |
| `MCL-NEW-INTERMEDIATE` | 中級、診断によりL2から開始 |
| `MCL-NEW-ADVANCED` | 上級、診断によりL3以降から開始 |

### 修了コード

```
MCL-COMPLETE-{YYYYMMDD}
```

例：`MCL-COMPLETE-20241204`（2024年12月4日に修了）

### レベル完了コード

各レベル完了時に発行される記念コード

| コード | 意味 |
|--------|------|
| `MCL-L1-CLEAR` | レベル1（基礎編）完了 |
| `MCL-L2-CLEAR` | レベル2（理論編）完了 |
| `MCL-L3-CLEAR` | レベル3（応用編）完了 |
| `MCL-L4-CLEAR` | レベル4（実践編）完了 |
| `MCL-L5-CLEAR` | レベル5（完成編）完了 = 修了 |

---

## コード生成ロジック

### セクション完了時

```python
def generate_progress_code(level: int, section: int, status: str) -> str:
    """
    進捗コードを生成する
    
    Args:
        level: レベル番号 (1-5)
        section: セクション番号 (1-20)
        status: ステータス ("OK", "IP", "RV")
    
    Returns:
        進捗コード文字列
    """
    return f"MCL-L{level}-S{section:02d}-{status}"

# 使用例
code = generate_progress_code(2, 7, "OK")
# 結果: "MCL-L2-S07-OK"
```

### コードのデコード

```python
def decode_progress_code(code: str) -> dict:
    """
    進捗コードをデコードする
    
    Args:
        code: 進捗コード文字列
    
    Returns:
        デコード結果の辞書
    """
    import re
    
    # 特殊コードのチェック
    if code.startswith("MCL-NEW-"):
        return {
            "type": "new",
            "level_start": code.split("-")[2].lower()
        }
    
    if code.startswith("MCL-COMPLETE-"):
        return {
            "type": "complete",
            "date": code.split("-")[2]
        }
    
    if code.endswith("-CLEAR"):
        level = int(code.split("-")[1][1])
        return {
            "type": "level_clear",
            "level": level
        }
    
    # 通常の進捗コード
    pattern = r"MCL-L(\d)-S(\d{2})-(\w{2})"
    match = re.match(pattern, code)
    
    if match:
        return {
            "type": "progress",
            "level": int(match.group(1)),
            "section": int(match.group(2)),
            "status": match.group(3)
        }
    
    return {"type": "invalid"}

# 使用例
result = decode_progress_code("MCL-L2-S07-OK")
# 結果: {"type": "progress", "level": 2, "section": 7, "status": "OK"}
```

---

## GPTsでの実装方法

GPTsではPythonコードを直接実行できないため、以下のロジックをシステムプロンプト内で自然言語として処理します。

### 進捗コード発行時のテンプレート

```
【進捗コード発行】

セクション{section}「{title}」を完了しました！

━━━━━━━━━━━━━━━━━
📋 進捗コード: MCL-L{level}-S{section:02d}-OK
━━━━━━━━━━━━━━━━━

このコードを保存しておいてくださいね。
次回の会話で教えていただければ、ここから再開できます。
```

### 進捗コード確認時の処理フロー

```
ユーザー: 「MCL-L2-S07-OK」

GPTs内部処理:
1. コードを解析
   - MCL = 正しいプレフィックス ✓
   - L2 = レベル2
   - S07 = セクション7
   - OK = 完了状態

2. 次のセクションを特定
   - セクション7完了 → 次はセクション8

3. レスポンス生成
   「進捗コードを確認しました！
    レベル2・セクション7まで完了していますね。
    
    次はレベル3・セクション8『お金の本質』に進みましょう！
    準備はいいですか？」
```

---

## セクション番号マッピング

### レベル別セクション対応表

| レベル | セクション | 内容 |
|--------|------------|------|
| L1 | S01 | 私とソースの関係 |
| L1 | S02 | ソースの本質 |
| L1 | S03 | 思考ちゃんとマインド様 |
| L1 | S04 | 「無」と時間の概念 |
| L2 | S05 | 100%信じる力 |
| L2 | S06 | 量子物理学と引き寄せ |
| L2 | S07 | マインド状態と周波数 |
| L3 | S08 | お金の本質 |
| L3 | S09 | 仕事と節約のマインド |
| L3 | S10 | 感謝の実践 |
| L3 | S11 | ソースに任せる |
| L3 | S12 | 感覚体験の理解 |
| L3 | S13 | ネガティブ感情の対処法 |
| L3 | S14 | 時間は存在しない（実践） |
| L4 | S15 | 引き寄せの6ステップ |
| L4 | S16 | よくある注意事項 |
| L4 | S17 | 日常での小さな引き寄せ |
| L5 | S18 | 過去への感謝 |
| L5 | S19 | 様々な教えとの共通点 |
| L5 | S20 | 永遠の幸せへ |

### 次セクション判定ロジック

```python
def get_next_section(current_section: int) -> dict:
    """
    次のセクション情報を取得
    """
    section_map = {
        1: {"next": 2, "level": 1, "title": "ソースの本質"},
        2: {"next": 3, "level": 1, "title": "思考ちゃんとマインド様"},
        3: {"next": 4, "level": 1, "title": "「無」と時間の概念"},
        4: {"next": 5, "level": 2, "title": "100%信じる力", "level_up": True},
        5: {"next": 6, "level": 2, "title": "量子物理学と引き寄せ"},
        6: {"next": 7, "level": 2, "title": "マインド状態と周波数"},
        7: {"next": 8, "level": 3, "title": "お金の本質", "level_up": True},
        # ... 以下同様
        19: {"next": 20, "level": 5, "title": "永遠の幸せへ"},
        20: {"next": None, "level": 5, "title": None, "complete": True}
    }
    return section_map.get(current_section, {"next": None})
```

---

## エラーハンドリング

### 無効なコードのパターン

| パターン | 対応 |
|----------|------|
| 形式が違う | 「このコードは認識できませんでした。正しい形式は MCL-L1-S01-OK のような形です」 |
| 存在しないセクション | 「セクション21は存在しません。最大はセクション20です」 |
| 存在しないレベル | 「レベル6は存在しません。レベルは1-5です」 |
| タイプミス | 「もしかして MCL-L2-S07-OK ですか？」（近いものを提案） |

### リカバリーオプション

```
コードが認識できない場合:

1. もう一度コードを確認してください
2. コードがわからない場合は、簡単な質問でどこまで学んだか確認できます
3. 最初からやり直すこともできます

どうされますか？
```

---

## 進捗の可視化

### 進捗バー表示（オプション）

```
【あなたの進捗】

レベル1 ████████████████████ 100% ✓
レベル2 ████████████████████ 100% ✓  
レベル3 ████████░░░░░░░░░░░░  42%
レベル4 ░░░░░░░░░░░░░░░░░░░░   0%
レベル5 ░░░░░░░░░░░░░░░░░░░░   0%

全体進捗: 11/20セクション (55%)
現在地: レベル3・セクション11「ソースに任せる」
```

### 簡易表示

```
📍 現在地: L3-S11（11/20セクション完了）
```

---

## 実装時の注意事項

1. **コードは大文字で統一**
   - ユーザーが小文字で入力しても、大文字に変換して処理

2. **コードの保存を促す**
   - 毎回のセッション終了時に必ずコードを提示
   - 「スクリーンショットを撮る」「メモに保存」を推奨

3. **コードなしでも対応**
   - コードを忘れた・なくした場合は、質問で現在地を特定
   - 「最後に学んだ内容を覚えていますか？」

4. **複数デバイス対応**
   - コードがあれば、どのデバイスからでも継続可能
   - 「別のデバイスから続きを学ぶこともできます」
